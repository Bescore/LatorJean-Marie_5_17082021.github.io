if("127.0.0.1"===location.hostname){var Urlapi="http://localhost:3000";console.log(Urlapi)}else var Urlapi="https://secret-cliffs-34868.herokuapp.com";function getArticleId(){return new URL(location.href).searchParams.get("article")}document.getElementById("mouv")&&fetch(`/api/cameras`).then(Resultatcamera=>Resultatcamera.json().then(cameras=>{let AffichageCamera='<ul style="display:flex; flex-wrap:wrap; margin:auto; align-items : center;justify-content:center;">';for(let camera of cameras)AffichageCamera+=`<li   class="card cardtransfo"  >\n                  <img class="card-img-top" src="${camera.imageUrl}" alt="Appareil photo">\n                  <a href="produit.html?article=${camera._id}"  class="stretched-link card-body">\n                    <p class="card-text text-dark">${"Modèle : "+camera.name}</p>\n                  </a>\n                </li>`;AffichageCamera+="</ul>",document.getElementById("mouv").innerHTML=AffichageCamera}).catch((function(){console.log("ne peut fetch la page index car vous êtes sur la mauvaise page")})));const id=getArticleId();function isclicked(){if(localStorage.getItem(id)){let Base=parseInt(localStorage.getItem(id));localStorage.setItem(id,++Base),alert("vous en choisissez un de plus"),reloadPage()}else localStorage.setItem(id,1),alert("vous avez sélectionné ce produit"),reloadPage()}function deleletItem(){localStorage.removeItem(id,id),alert("vous avez enlevé ce produit du panier"),reloadPage()}function deleteLastitem(){localStorage.removeItem(localStorage.key(localStorage.length-1)),0===localStorage.length&&sessionStorage.removeItem("prix")}function deleteAllitem(){localStorage.clear(),sessionStorage.removeItem("Idorder"),sessionStorage.removeItem("prix")}function reloadPage(){document.location.reload()}function allStorage(){var values=[],AffichageCamera="",somme=0;for(let i=0;i<localStorage.length;i++)values.push(Object.keys(localStorage)[i]),fetch(`/api/cameras/${values[i]}`).then(Resultatcamera=>Resultatcamera.json().then(cameras=>{document.getElementById("mouv3")&&(AffichageCamera+=`<div   class="card cardmouv cardpic">\n            <img class="card-img-top" src="${cameras.imageUrl}" alt="Appareil photo">\n            <a href="produit.html?article=${cameras._id}" style="text-decoration:none" class=" stretched-link card-body">\n              <p class="card-text my-1 text-dark">${"Modèle : "+cameras.name}</p>\n              <p  class="card-text text-dark "><span>Prix :</span>${" "+cameras.price/100+" €"}</p>\n              <p class="quantity" >(${localStorage.getItem(cameras._id)})</p>\n            </a>\n          </div>`,document.getElementById("mouv3").innerHTML=AffichageCamera,somme+=localStorage.getItem(cameras._id)*cameras.price/100,Price.push(somme),console.log(Price),document.getElementById("total").innerHTML="Coût total : "+somme+"€",sessionStorage.setItem("prix",somme))}))}document.getElementById("mouv2")&&fetch(`/api/cameras/`).then(resultat=>resultat.json().then(data2=>{let Displaylenses,affichage2=`<div class="card cart-card" >\n        <img class="card-img-top" src="${data2.imageUrl}" alt="Appareil photo">\n        <div style="display:flex;justify-content-center;flex-direction:column" class="card-body">\n          <p  class="card-text"><span>Modèle :</span>${"  "+data2.name}</p>\n          <p  class="card-text"><span>Prix :</span>${" "+data2.price/100+" €"}</p>\n          <label class="forlenses card-text"  for="lense-select">Lentilles</label>\n          <select  class="form-group" id="lense-select"></select>\n          <button id=${data2.id}  type="button" onClick="isclicked(id)"   class="btn btn-primary btn-sm touch ">Selectionner</button>\n          <button id=${data2._id}  type="submit" onclick="deleletItem(id)" class="btn btn-primary btn-sm touch ">Supprimer du panier</button>\n        </div>\n      </div>`,quantity=`<div class="value text-center text-warning fs-4">Quantité: ${localStorage.getItem(id)}</div>`,Notincart='<div class="value text-center text-warning fs-4" >Ce produit n\'est pas dans votre panier</div>';for(let lense of data2.lenses)Displaylenses+=`<option value=""></option>`;document.getElementById("mouv2").innerHTML=affichage2,document.getElementById("lense-select").innerHTML=Displaylenses,null==localStorage.getItem(id)?document.getElementById("quantity").innerHTML=Notincart:document.getElementById("quantity").innerHTML=quantity}));var Price=[];function isValidated(x,id){if(/^[a-zA-z\s]+$/.test(x)){let valide='<p class=" alert alert-success fs-6">Valide !</p>';document.getElementById(id).innerHTML=valide}else{let Nonvalide='<p id="nonvalide" class="alert alert-danger fs-6">Non valide !</p>';document.getElementById(id).innerHTML=Nonvalide}}function validAdress(x,id){if(/[0-9\\/# ,a-zA-Z]+[ ,]+[0-9\\/#, a-zA-Z]{1,}/.test(x)){let valide='<p class="alert alert-success fs-6">Valide !</p>';document.getElementById(id).innerHTML=valide}else{let Nonvalide='<p id="nonvalide" class="alert alert-danger fs-6">Non valide !</p>';document.getElementById(id).innerHTML=Nonvalide,document.getElementById("adress").value=""}}function validMail(x,id){if(/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(x)){let valide='<p class=" alert alert-success fs-6">Valide !</i></p>';document.getElementById(id).innerHTML=valide}else{let Nonvalide='<p id="nonvalide" class="alert alert-danger fs-6">Non valide !</p>';document.getElementById(id).innerHTML=Nonvalide,document.getElementById("email").value=""}}const Prenom=document.getElementById("firstName");if(document.getElementById("mouv3")){function getName(){isValidated(Prenom.value,"validate"),contact.firstName=`${Prenom.value}`}Prenom.addEventListener("change",getName)}const Nom=document.getElementById("lastName");if(document.getElementById("mouv3")){function getlastName(){isValidated(Nom.value,"validate1"),contact.lastName=`${Nom.value}`}Nom.addEventListener("change",getlastName)}const Adress=document.getElementById("adress");if(document.getElementById("mouv3")){function getadress(){validAdress(Adress.value,"validate2"),contact.address=`${Adress.value}`}Adress.addEventListener("change",getadress)}const City=document.getElementById("city");if(document.getElementById("mouv3")){function getcity(){isValidated(City.value,"validate3"),contact.city=`${City.value}`}City.addEventListener("change",getcity)}const Email=document.getElementById("email");if(document.getElementById("mouv3")){function getemail(){validMail(Email.value,"validate4"),console.log(Email.value),contact.email=`${Email.value}`}Email.addEventListener("change",getemail)}var contact={firstName:"",lastName:"",address:"",city:"",email:""};const isEmpty=Object.values(contact).every(x=>null===x||""===x);var products=Object.keys(localStorage);function Forms(){event.preventDefault(),fetch("http://localhost:3000/api/cameras/order",{method:"POST",body:JSON.stringify({contact:contact,products:products}),headers:{"Content-Type":"application/json"}}).then(Resultat=>Resultat.json().then(POST=>{console.log(POST),sessionStorage.setItem("Idorder",`${POST.orderId}`),document.getElementById("nonvalide")?alert("Le formulaire est invalide"):POST.orderId&&sessionStorage.getItem("prix")&&!1!==isEmpty?window.location.href="commande.html":alert("Veuillez selectionner un produit et/ou remplir le formulaire")}))}var Iddecommande=sessionStorage.getItem("Idorder");function Displayorder(){Iddecommande&&document.getElementById("mouv4")&&(document.getElementById("mouv4").innerHTML="Commande: "+Iddecommande)}Displayorder();var Prixdecommande=sessionStorage.getItem("prix");function Displayprice(){Prixdecommande&&document.getElementById("mouv4")&&(document.getElementById("totalC").innerText="Merci de nous avoir choisi ! le coût total de votre commande est de : "+Prixdecommande+" €")}Displayprice();